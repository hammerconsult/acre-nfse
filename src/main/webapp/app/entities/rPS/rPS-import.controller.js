(function () {
    'use strict';

angular.module('nfseApp').controller('RPSImportController',
    ['$scope', '$stateParams', 'entity', 'RPS', 'localStorageService', '$state', 'Notificacao',
        function ($scope, $stateParams, entity, RPS, localStorageService, $state, Notificacao) {

            $scope.lote = {file: '', inscricaoCadastral: localStorageService.get("prestadorPrincipal").prestador.inscricaoMunicipal};
            $scope.xmlV10 = "<EnviarLoteRpsEnvio><LoteRps><NumeroLote>?</NumeroLote><Cnpj>?</Cnpj><InscricaoMunicipal>?</InscricaoMunicipal><QuantidadeRps>?</QuantidadeRps><ListaRps><Rps><InfRps><IdentificacaoRps><Numero>?</Numero><Serie>?</Serie><Tipo>?</Tipo></IdentificacaoRps><DataEmissao>?</DataEmissao><NaturezaOperacao>?</NaturezaOperacao><OptanteSimplesNacional>?</OptanteSimplesNacional><IncentivadorCultural>?</IncentivadorCultural><Status>?</Status><Servico><Valores><ValorServicos>?</ValorServicos><IssRetido>?</IssRetido><ValorIss>?</ValorIss><BaseCalculo>?</BaseCalculo><Aliquota>?</Aliquota><ValorLiquidoNfse>?</ValorLiquidoNfse></Valores><ItemListaServico>?</ItemListaServico><Discriminacao>?</Discriminacao><CodigoMunicipio>?</CodigoMunicipio></Servico><Prestador><Cnpj>?</Cnpj><InscricaoMunicipal>?</InscricaoMunicipal></Prestador><Tomador><IdentificacaoTomador><CpfCnpj><Cnpj>?</Cnpj></CpfCnpj></IdentificacaoTomador><RazaoSocial>?</RazaoSocial><Endereco><Endereco>?</Endereco><Numero>?</Numero><Bairro>?</Bairro><CodigoMunicipio>?</CodigoMunicipio><Uf>?</Uf><Cep>?</Cep></Endereco></Tomador></InfRps></Rps></ListaRps></LoteRps></EnviarLoteRpsEnvio>"
            $scope.xmlV12Sincrono = "<EnviarLoteRpsSincronoEnvio xmlns=\"http://nfse.webpublico.com.br/iss/nfse_v1_2.xsd\"> <IdentificacaoRequerente> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <InscricaoMunicipal>?</InscricaoMunicipal> <Senha>?</Senha> <Homologa>?</Homologa> </IdentificacaoRequerente> <LoteRps> <NumeroLote>?</NumeroLote> <QuantidadeRps>?</QuantidadeRps> <ListaRps> <!--1 or more repetitions:--> <DeclaracaoPrestacaoServico> <InfDeclaracaoPrestacaoServico> <!--Optional:--> <Rps> <IdentificacaoRps> <Numero>?</Numero> <Serie>?</Serie> <Tipo>?</Tipo> </IdentificacaoRps> <DataEmissao>?</DataEmissao> <Status>?</Status> <!--Optional:--> <RpsSubstituido> <Numero>?</Numero> <Serie>?</Serie> <Tipo>?</Tipo> </RpsSubstituido> </Rps> <Competencia>?</Competencia> <Servico> <Valores> <ValorServicos>?</ValorServicos> <!--Optional:--> <ValorDeducoes>?</ValorDeducoes> <!--Optional:--> <ValorPis>?</ValorPis> <!--Optional:--> <ValorCofins>?</ValorCofins> <!--Optional:--> <ValorInss>?</ValorInss> <!--Optional:--> <ValorIr>?</ValorIr> <!--Optional:--> <ValorCsll>?</ValorCsll> <!--Optional:--> <OutrasRetencoes>?</OutrasRetencoes> <!--Optional:--> <ValorIss>?</ValorIss> <!--Optional:--> <Aliquota>?</Aliquota> <!--Optional:--> <DescontoIncondicionado>?</DescontoIncondicionado> <!--Optional:--> <DescontoCondicionado>?</DescontoCondicionado> </Valores> <IssRetido>?</IssRetido> <!--Optional:--> <ResponsavelRetencao>?</ResponsavelRetencao> <Discriminacao>?</Discriminacao> <CodigoMunicipio>?</CodigoMunicipio> <!--Optional:--> <CodigoPais>?</CodigoPais> <ExigibilidadeISS>?</ExigibilidadeISS> <MunicipioIncidencia>?</MunicipioIncidencia> <!--Optional:--> <NumeroProcesso>?</NumeroProcesso> <ListaItensServico> <!--1 or more repetitions:--> <ItemServico> <ItemListaServico>?</ItemListaServico> <CodigoCnae>?</CodigoCnae> <Descricao>?</Descricao> <Tributavel>?</Tributavel> <Quantidade>?</Quantidade> <ValorUnitario>?</ValorUnitario> <!--Optional:--> <ValorDesconto>?</ValorDesconto> <ValorLiquido>?</ValorLiquido> <!--Optional:--> <DadosDeducao> <TipoDeducao>?</TipoDeducao> <!--Optional:--> <Cpf>?</Cpf> <!--Optional:--> <Cnpj>?</Cnpj> <!--Optional:--> <NumeroNotaFiscalReferencia>?</NumeroNotaFiscalReferencia> <!--Optional:--> <ValorTotalNotaFiscal>?</ValorTotalNotaFiscal> <!--Optional:--> <PercentualADeduzir>?</PercentualADeduzir> <!--Optional:--> <ValorADeduzir>?</ValorADeduzir> </DadosDeducao> </ItemServico> </ListaItensServico> </Servico> <DadosPrestador> <IdentificacaoPrestador> <!--Optional:--> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <!--Optional:--> <InscricaoMunicipal>?</InscricaoMunicipal> </IdentificacaoPrestador> <RazaoSocial>?</RazaoSocial> <!--Optional:--> <NomeFantasia>?</NomeFantasia> <Endereco> <!--Optional:--> <Endereco>?</Endereco> <!--Optional:--> <Numero>?</Numero> <!--Optional:--> <Complemento>?</Complemento> <!--Optional:--> <Bairro>?</Bairro> <!--Optional:--> <CodigoMunicipio>?</CodigoMunicipio> <!--Optional:--> <CidadeNome>?</CidadeNome> <!--Optional:--> <Uf>?</Uf> <!--Optional:--> <CodigoPais>?</CodigoPais> <!--Optional:--> <Cep>?</Cep> </Endereco> <!--Optional:--> <Contato> <!--Optional:--> <Telefone>?</Telefone> <!--Optional:--> <Email>?</Email> </Contato> </DadosPrestador> <!--Optional:--> <Tomador> <!--Optional:--> <IdentificacaoTomador> <!--Optional:--> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <!--Optional:--> <InscricaoMunicipal>?</InscricaoMunicipal> </IdentificacaoTomador> <!--Optional:--> <RazaoSocial>?</RazaoSocial> <!--Optional:--> <Endereco> <!--Optional:--> <Endereco>?</Endereco> <!--Optional:--> <Numero>?</Numero> <!--Optional:--> <Complemento>?</Complemento> <!--Optional:--> <Bairro>?</Bairro> <!--Optional:--> <CodigoMunicipio>?</CodigoMunicipio> <!--Optional:--> <CidadeNome>?</CidadeNome> <!--Optional:--> <Uf>?</Uf> <!--Optional:--> <CodigoPais>?</CodigoPais> <!--Optional:--> <Cep>?</Cep> </Endereco> <!--Optional:--> <Contato> <!--Optional:--> <Telefone>?</Telefone> <!--Optional:--> <Email>?</Email> </Contato> <!--Optional:--> <InscricaoEstadual>?</InscricaoEstadual> </Tomador> <!--Optional:--> <Intermediario> <IdentificacaoIntermediario> <!--Optional:--> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <!--Optional:--> <InscricaoMunicipal>?</InscricaoMunicipal> </IdentificacaoIntermediario> <RazaoSocial>?</RazaoSocial> </Intermediario> <!--Optional:--> <ConstrucaoCivil> <!--Optional:--> <CodigoObra>?</CodigoObra> <Art>?</Art> <!--Optional:--> <Incorporacao>?</Incorporacao> </ConstrucaoCivil> <!--Optional:--> <RegimeEspecialTributacao>?</RegimeEspecialTributacao> <IncentivoFiscal>?</IncentivoFiscal> </InfDeclaracaoPrestacaoServico> </DeclaracaoPrestacaoServico> </ListaRps> </LoteRps> </EnviarLoteRpsSincronoEnvio>";
            $scope.xmlV12Assincrono = "<EnviarLoteRpsEnvio xmlns=\"http://nfse.webpublico.com.br/iss/nfse_v1_2.xsd\"> <IdentificacaoRequerente> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <InscricaoMunicipal>?</InscricaoMunicipal> <Senha>?</Senha> <Homologa>?</Homologa> </IdentificacaoRequerente> <LoteRps> <NumeroLote>?</NumeroLote> <QuantidadeRps>?</QuantidadeRps> <ListaRps> <!--1 or more repetitions:--> <DeclaracaoPrestacaoServico> <InfDeclaracaoPrestacaoServico> <!--Optional:--> <Rps> <IdentificacaoRps> <Numero>?</Numero> <Serie>?</Serie> <Tipo>?</Tipo> </IdentificacaoRps> <DataEmissao>?</DataEmissao> <Status>?</Status> <!--Optional:--> <RpsSubstituido> <Numero>?</Numero> <Serie>?</Serie> <Tipo>?</Tipo> </RpsSubstituido> </Rps> <Competencia>?</Competencia> <Servico> <Valores> <ValorServicos>?</ValorServicos> <!--Optional:--> <ValorDeducoes>?</ValorDeducoes> <!--Optional:--> <ValorPis>?</ValorPis> <!--Optional:--> <ValorCofins>?</ValorCofins> <!--Optional:--> <ValorInss>?</ValorInss> <!--Optional:--> <ValorIr>?</ValorIr> <!--Optional:--> <ValorCsll>?</ValorCsll> <!--Optional:--> <OutrasRetencoes>?</OutrasRetencoes> <!--Optional:--> <ValorIss>?</ValorIss> <!--Optional:--> <Aliquota>?</Aliquota> <!--Optional:--> <DescontoIncondicionado>?</DescontoIncondicionado> <!--Optional:--> <DescontoCondicionado>?</DescontoCondicionado> </Valores> <IssRetido>?</IssRetido> <!--Optional:--> <ResponsavelRetencao>?</ResponsavelRetencao> <Discriminacao>?</Discriminacao> <CodigoMunicipio>?</CodigoMunicipio> <!--Optional:--> <CodigoPais>?</CodigoPais> <ExigibilidadeISS>?</ExigibilidadeISS> <MunicipioIncidencia>?</MunicipioIncidencia> <!--Optional:--> <NumeroProcesso>?</NumeroProcesso> <ListaItensServico> <!--1 or more repetitions:--> <ItemServico> <ItemListaServico>?</ItemListaServico> <CodigoCnae>?</CodigoCnae> <Descricao>?</Descricao> <Tributavel>?</Tributavel> <Quantidade>?</Quantidade> <ValorUnitario>?</ValorUnitario> <!--Optional:--> <ValorDesconto>?</ValorDesconto> <ValorLiquido>?</ValorLiquido> <!--Optional:--> <DadosDeducao> <TipoDeducao>?</TipoDeducao> <!--Optional:--> <Cpf>?</Cpf> <!--Optional:--> <Cnpj>?</Cnpj> <!--Optional:--> <NumeroNotaFiscalReferencia>?</NumeroNotaFiscalReferencia> <!--Optional:--> <ValorTotalNotaFiscal>?</ValorTotalNotaFiscal> <!--Optional:--> <PercentualADeduzir>?</PercentualADeduzir> <!--Optional:--> <ValorADeduzir>?</ValorADeduzir> </DadosDeducao> </ItemServico> </ListaItensServico> </Servico> <DadosPrestador> <IdentificacaoPrestador> <!--Optional:--> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <!--Optional:--> <InscricaoMunicipal>?</InscricaoMunicipal> </IdentificacaoPrestador> <RazaoSocial>?</RazaoSocial> <!--Optional:--> <NomeFantasia>?</NomeFantasia> <Endereco> <!--Optional:--> <Endereco>?</Endereco> <!--Optional:--> <Numero>?</Numero> <!--Optional:--> <Complemento>?</Complemento> <!--Optional:--> <Bairro>?</Bairro> <!--Optional:--> <CodigoMunicipio>?</CodigoMunicipio> <!--Optional:--> <CidadeNome>?</CidadeNome> <!--Optional:--> <Uf>?</Uf> <!--Optional:--> <CodigoPais>?</CodigoPais> <!--Optional:--> <Cep>?</Cep> </Endereco> <!--Optional:--> <Contato> <!--Optional:--> <Telefone>?</Telefone> <!--Optional:--> <Email>?</Email> </Contato> </DadosPrestador> <!--Optional:--> <Tomador> <!--Optional:--> <IdentificacaoTomador> <!--Optional:--> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <!--Optional:--> <InscricaoMunicipal>?</InscricaoMunicipal> </IdentificacaoTomador> <!--Optional:--> <RazaoSocial>?</RazaoSocial> <!--Optional:--> <Endereco> <!--Optional:--> <Endereco>?</Endereco> <!--Optional:--> <Numero>?</Numero> <!--Optional:--> <Complemento>?</Complemento> <!--Optional:--> <Bairro>?</Bairro> <!--Optional:--> <CodigoMunicipio>?</CodigoMunicipio> <!--Optional:--> <CidadeNome>?</CidadeNome> <!--Optional:--> <Uf>?</Uf> <!--Optional:--> <CodigoPais>?</CodigoPais> <!--Optional:--> <Cep>?</Cep> </Endereco> <!--Optional:--> <Contato> <!--Optional:--> <Telefone>?</Telefone> <!--Optional:--> <Email>?</Email> </Contato> <!--Optional:--> <InscricaoEstadual>?</InscricaoEstadual> </Tomador> <!--Optional:--> <Intermediario> <IdentificacaoIntermediario> <!--Optional:--> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <!--Optional:--> <InscricaoMunicipal>?</InscricaoMunicipal> </IdentificacaoIntermediario> <RazaoSocial>?</RazaoSocial> </Intermediario> <!--Optional:--> <ConstrucaoCivil> <!--Optional:--> <CodigoObra>?</CodigoObra> <Art>?</Art> <!--Optional:--> <Incorporacao>?</Incorporacao> </ConstrucaoCivil> <!--Optional:--> <RegimeEspecialTributacao>?</RegimeEspecialTributacao> <IncentivoFiscal>?</IncentivoFiscal> </InfDeclaracaoPrestacaoServico> </DeclaracaoPrestacaoServico> </ListaRps> </LoteRps> </EnviarLoteRpsEnvio>";
            $scope.xmlV23Sincrono = "<EnviarLoteRpsSincronoEnvio xmlns:nfse=\"http://nfse.webpublico.com.br/iss/nfse_v2_03.xsd\"> <IdentificacaoRequerente> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <InscricaoMunicipal>?</InscricaoMunicipal> <Senha>?</Senha> <Homologa>?</Homologa> </IdentificacaoRequerente> <LoteRps versao=\"?\"> <NumeroLote>?</NumeroLote> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <!--Optional:--> <InscricaoMunicipal>?</InscricaoMunicipal> <QuantidadeRps>?</QuantidadeRps> <ListaRps> <!--1 or more repetitions:--> <Rps> <InfDeclaracaoPrestacaoServico> <!--Optional:--> <Rps> <IdentificacaoRps> <Numero>?</Numero> <Serie>?</Serie> <Tipo>?</Tipo> </IdentificacaoRps> <DataEmissao>?</DataEmissao> <Status>?</Status> <!--Optional:--> <RpsSubstituido> <Numero>?</Numero> <Serie>?</Serie> <Tipo>?</Tipo> </RpsSubstituido> </Rps> <Competencia>?</Competencia> <Servico> <Valores> <ValorServicos>?</ValorServicos> <!--Optional:--> <ValorDeducoes>?</ValorDeducoes> <!--Optional:--> <AliquotaPis>?</AliquotaPis> <!--Optional:--> <RetidoPis>?</RetidoPis> <!--Optional:--> <ValorPis>?</ValorPis> <!--Optional:--> <AliquotaCofins>?</AliquotaCofins> <!--Optional:--> <RetidoCofins>?</RetidoCofins> <!--Optional:--> <ValorCofins>?</ValorCofins> <!--Optional:--> <AliquotaInss>?</AliquotaInss> <!--Optional:--> <RetidoInss>?</RetidoInss> <!--Optional:--> <ValorInss>?</ValorInss> <!--Optional:--> <AliquotaIr>?</AliquotaIr> <!--Optional:--> <RetidoIr>?</RetidoIr> <!--Optional:--> <ValorIr>?</ValorIr> <!--Optional:--> <AliquotaCsll>?</AliquotaCsll> <!--Optional:--> <RetidoCsll>?</RetidoCsll> <!--Optional:--> <ValorCsll>?</ValorCsll> <!--Optional:--> <AliquotaCpp>?</AliquotaCpp> <!--Optional:--> <RetidoCpp>?</RetidoCpp> <!--Optional:--> <ValorCpp>?</ValorCpp> <!--Optional:--> <OutrasRetencoes>?</OutrasRetencoes> <!--Optional:--> <RetidoOutrasRetencoes>?</RetidoOutrasRetencoes> <!--Optional:--> <AliquotaTotTributos>?</AliquotaTotTributos> <!--Optional:--> <ValTotTributos>?</ValTotTributos> <!--Optional:--> <ValorIss>?</ValorIss> <!--Optional:--> <Aliquota>?</Aliquota> <!--Optional:--> <DescontoIncondicionado>?</DescontoIncondicionado> <!--Optional:--> <DescontoCondicionado>?</DescontoCondicionado> </Valores> <IssRetido>?</IssRetido> <!--Optional:--> <ResponsavelRetencao>?</ResponsavelRetencao> <Discriminacao>?</Discriminacao> <!--Optional:--> <CodigoTributacaoMunicipio>?</CodigoTributacaoMunicipio> <!--Optional:--> <CodigoNbs>?</CodigoNbs> <CodigoMunicipio>?</CodigoMunicipio> <!--Optional:--> <CodigoPais>?</CodigoPais> <ExigibilidadeISS>?</ExigibilidadeISS> <MunicipioIncidencia>?</MunicipioIncidencia> <!--Optional:--> <NumeroProcesso>?</NumeroProcesso> <ListaItensServico> <!--1 or more repetitions:--> <ItemServico> <ItemListaServico>?</ItemListaServico> <CodigoCnae>?</CodigoCnae> <Descricao>?</Descricao> <!--Optional:--> <Unidade>?</Unidade> <Tributavel>?</Tributavel> <Quantidade>?</Quantidade> <ValorUnitario>?</ValorUnitario> <!--Optional:--> <ValorDesconto>?</ValorDesconto> <ValorLiquido>?</ValorLiquido> <!--Optional:--> <DadosDeducao> <TipoDeducao>?</TipoDeducao> <!--Optional:--> <Cpf>?</Cpf> <!--Optional:--> <Cnpj>?</Cnpj> <!--Optional:--> <NumeroNotaFiscalReferencia>?</NumeroNotaFiscalReferencia> <!--Optional:--> <ValorTotalNotaFiscal>?</ValorTotalNotaFiscal> <!--Optional:--> <PercentualADeduzir>?</PercentualADeduzir> <!--Optional:--> <ValorADeduzir>?</ValorADeduzir> </DadosDeducao> </ItemServico> </ListaItensServico> </Servico> <Prestador> <!--Optional:--> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <!--Optional:--> <InscricaoMunicipal>?</InscricaoMunicipal> </Prestador> <!--Optional:--> <Tomador> <!--Optional:--> <IdentificacaoTomador> <!--Optional:--> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <!--Optional:--> <InscricaoMunicipal>?</InscricaoMunicipal> </IdentificacaoTomador> <!--Optional:--> <NifTomador>?</NifTomador> <!--Optional:--> <RazaoSocial>?</RazaoSocial> <!--Optional:--> <Endereco> <!--Optional:--> <Endereco>?</Endereco> <!--Optional:--> <Numero>?</Numero> <!--Optional:--> <Complemento>?</Complemento> <!--Optional:--> <Bairro>?</Bairro> <!--Optional:--> <CodigoMunicipio>?</CodigoMunicipio> <!--Optional:--> <Uf>?</Uf> <!--Optional:--> <CodigoPais>?</CodigoPais> <!--Optional:--> <Cep>?</Cep> </Endereco> <!--Optional:--> <Contato> <!--Optional:--> <Telefone>?</Telefone> <!--Optional:--> <Email>?</Email> </Contato> <!--Optional:--> <InscricaoEstadual>?</InscricaoEstadual> </Tomador> <!--Optional:--> <Intermediario> <IdentificacaoIntermediario> <!--Optional:--> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <!--Optional:--> <InscricaoMunicipal>?</InscricaoMunicipal> </IdentificacaoIntermediario> <RazaoSocial>?</RazaoSocial> <CodigoMunicipio>?</CodigoMunicipio> </Intermediario> <!--Optional:--> <ConstrucaoCivil> <!--Optional:--> <CodigoObra>?</CodigoObra> <!--Optional:--> <NumeroAlvaraConstrucao>?</NumeroAlvaraConstrucao> <Art>?</Art> <!--Optional:--> <Incorporacao>?</Incorporacao> </ConstrucaoCivil> <!--Optional:--> <RegimeEspecialTributacao>?</RegimeEspecialTributacao> <IncentivoFiscal>?</IncentivoFiscal> </InfDeclaracaoPrestacaoServico> </Rps> </ListaRps> </LoteRps> </EnviarLoteRpsSincronoEnvio>";
            $scope.xmlV23Assincrono = "<EnviarLoteRpsEnvio xmlns:nfse=\"http://nfse.webpublico.com.br/iss/nfse_v2_03.xsd\"> <IdentificacaoRequerente> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <InscricaoMunicipal>?</InscricaoMunicipal> <Senha>?</Senha> <Homologa>?</Homologa> </IdentificacaoRequerente> <LoteRps versao=\"?\"> <NumeroLote>?</NumeroLote> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <!--Optional:--> <InscricaoMunicipal>?</InscricaoMunicipal> <QuantidadeRps>?</QuantidadeRps> <ListaRps> <!--1 or more repetitions:--> <Rps> <InfDeclaracaoPrestacaoServico> <!--Optional:--> <Rps> <IdentificacaoRps> <Numero>?</Numero> <Serie>?</Serie> <Tipo>?</Tipo> </IdentificacaoRps> <DataEmissao>?</DataEmissao> <Status>?</Status> <!--Optional:--> <RpsSubstituido> <Numero>?</Numero> <Serie>?</Serie> <Tipo>?</Tipo> </RpsSubstituido> </Rps> <Competencia>?</Competencia> <Servico> <Valores> <ValorServicos>?</ValorServicos> <!--Optional:--> <ValorDeducoes>?</ValorDeducoes> <!--Optional:--> <AliquotaPis>?</AliquotaPis> <!--Optional:--> <RetidoPis>?</RetidoPis> <!--Optional:--> <ValorPis>?</ValorPis> <!--Optional:--> <AliquotaCofins>?</AliquotaCofins> <!--Optional:--> <RetidoCofins>?</RetidoCofins> <!--Optional:--> <ValorCofins>?</ValorCofins> <!--Optional:--> <AliquotaInss>?</AliquotaInss> <!--Optional:--> <RetidoInss>?</RetidoInss> <!--Optional:--> <ValorInss>?</ValorInss> <!--Optional:--> <AliquotaIr>?</AliquotaIr> <!--Optional:--> <RetidoIr>?</RetidoIr> <!--Optional:--> <ValorIr>?</ValorIr> <!--Optional:--> <AliquotaCsll>?</AliquotaCsll> <!--Optional:--> <RetidoCsll>?</RetidoCsll> <!--Optional:--> <ValorCsll>?</ValorCsll> <!--Optional:--> <AliquotaCpp>?</AliquotaCpp> <!--Optional:--> <RetidoCpp>?</RetidoCpp> <!--Optional:--> <ValorCpp>?</ValorCpp> <!--Optional:--> <OutrasRetencoes>?</OutrasRetencoes> <!--Optional:--> <RetidoOutrasRetencoes>?</RetidoOutrasRetencoes> <!--Optional:--> <AliquotaTotTributos>?</AliquotaTotTributos> <!--Optional:--> <ValTotTributos>?</ValTotTributos> <!--Optional:--> <ValorIss>?</ValorIss> <!--Optional:--> <Aliquota>?</Aliquota> <!--Optional:--> <DescontoIncondicionado>?</DescontoIncondicionado> <!--Optional:--> <DescontoCondicionado>?</DescontoCondicionado> </Valores> <IssRetido>?</IssRetido> <!--Optional:--> <ResponsavelRetencao>?</ResponsavelRetencao> <Discriminacao>?</Discriminacao> <!--Optional:--> <CodigoTributacaoMunicipio>?</CodigoTributacaoMunicipio> <!--Optional:--> <CodigoNbs>?</CodigoNbs> <CodigoMunicipio>?</CodigoMunicipio> <!--Optional:--> <CodigoPais>?</CodigoPais> <ExigibilidadeISS>?</ExigibilidadeISS> <MunicipioIncidencia>?</MunicipioIncidencia> <!--Optional:--> <NumeroProcesso>?</NumeroProcesso> <ListaItensServico> <!--1 or more repetitions:--> <ItemServico> <ItemListaServico>?</ItemListaServico> <CodigoCnae>?</CodigoCnae> <Descricao>?</Descricao> <!--Optional:--> <Unidade>?</Unidade> <Tributavel>?</Tributavel> <Quantidade>?</Quantidade> <ValorUnitario>?</ValorUnitario> <!--Optional:--> <ValorDesconto>?</ValorDesconto> <ValorLiquido>?</ValorLiquido> <!--Optional:--> <DadosDeducao> <TipoDeducao>?</TipoDeducao> <!--Optional:--> <Cpf>?</Cpf> <!--Optional:--> <Cnpj>?</Cnpj> <!--Optional:--> <NumeroNotaFiscalReferencia>?</NumeroNotaFiscalReferencia> <!--Optional:--> <ValorTotalNotaFiscal>?</ValorTotalNotaFiscal> <!--Optional:--> <PercentualADeduzir>?</PercentualADeduzir> <!--Optional:--> <ValorADeduzir>?</ValorADeduzir> </DadosDeducao> </ItemServico> </ListaItensServico> </Servico> <Prestador> <!--Optional:--> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <!--Optional:--> <InscricaoMunicipal>?</InscricaoMunicipal> </Prestador> <!--Optional:--> <Tomador> <!--Optional:--> <IdentificacaoTomador> <!--Optional:--> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <!--Optional:--> <InscricaoMunicipal>?</InscricaoMunicipal> </IdentificacaoTomador> <!--Optional:--> <NifTomador>?</NifTomador> <!--Optional:--> <RazaoSocial>?</RazaoSocial> <!--Optional:--> <Endereco> <!--Optional:--> <Endereco>?</Endereco> <!--Optional:--> <Numero>?</Numero> <!--Optional:--> <Complemento>?</Complemento> <!--Optional:--> <Bairro>?</Bairro> <!--Optional:--> <CodigoMunicipio>?</CodigoMunicipio> <!--Optional:--> <Uf>?</Uf> <!--Optional:--> <CodigoPais>?</CodigoPais> <!--Optional:--> <Cep>?</Cep> </Endereco> <!--Optional:--> <Contato> <!--Optional:--> <Telefone>?</Telefone> <!--Optional:--> <Email>?</Email> </Contato> <!--Optional:--> <InscricaoEstadual>?</InscricaoEstadual> </Tomador> <!--Optional:--> <Intermediario> <IdentificacaoIntermediario> <!--Optional:--> <CpfCnpj> <!--You have a CHOICE of the next 2 items at this level--> <Cpf>?</Cpf> <Cnpj>?</Cnpj> </CpfCnpj> <!--Optional:--> <InscricaoMunicipal>?</InscricaoMunicipal> </IdentificacaoIntermediario> <RazaoSocial>?</RazaoSocial> <CodigoMunicipio>?</CodigoMunicipio> </Intermediario> <!--Optional:--> <ConstrucaoCivil> <!--Optional:--> <CodigoObra>?</CodigoObra> <!--Optional:--> <NumeroAlvaraConstrucao>?</NumeroAlvaraConstrucao> <Art>?</Art> <!--Optional:--> <Incorporacao>?</Incorporacao> </ConstrucaoCivil> <!--Optional:--> <RegimeEspecialTributacao>?</RegimeEspecialTributacao> <IncentivoFiscal>?</IncentivoFiscal> </InfDeclaracaoPrestacaoServico> </Rps> </ListaRps> </LoteRps> </EnviarLoteRpsEnvio>";

            $scope.uploadXmlFile = function (file) {
                var reader = new FileReader();
                reader.onload = function (evt) {
                    $scope.$apply(function ($scope) {
                        $scope.arquivoSelecionado = file;
                        $scope.lote.file = evt.target.result;
                    });
                };
                reader.readAsDataURL(file);
            };


            $scope.enviarArquivo = function () {
                RPS.importar($scope.lote, function (data) {
                    if (data.id) {
                        $state.go("loteRPS.detail", {id: data.id})
                    } else {
                        var mensagem = data.mensagens.join('<br/>');
                        Notificacao.error("Atenção", mensagem);
                    }
                });
            }

        }]);
})();